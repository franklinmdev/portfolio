---
import { getLangFromUrl, getLocalizedUrl, useTranslations } from "@/i18n/utils"
import { getCollection } from "astro:content"
import ProjectsSection from "./react/ProjectsSection"

// Get current language and translation function
const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)

// Fetch all projects from content collections and filter by current language
const allProjects = await getCollection("projects")

const projectsForCurrentLang = allProjects.filter((project) => {
  // Extract language from project ID (e.g., "en/devflow" -> "en")
  const [projectLang] = project.id.split("/")
  return projectLang === lang
})

// Map to the format expected by the React component
const projects = projectsForCurrentLang.map((project) => {
  // Extract slug from project ID (e.g., "en/devflow" -> "devflow")
  const [, ...slugParts] = project.id.split("/")
  const slug = slugParts.join("/")

  return {
    id: slug || project.id,
    title: project.data.title,
    description: Array.isArray(project.data.description)
      ? project.data.description[0] || ""
      : project.data.description || "",
    icon: project.data.icon,
    featured: project.data.featured,
    href: getLocalizedUrl(`projects/${slug}`, lang),
  }
})

// Pass translations to React component
const translations = {
  title: t("sections.projects_title"),
  viewAllBtn: t("projects.view_all_btn"),
  showLessBtn: t("projects.show_less_btn"),
}
---

<ProjectsSection client:load projects={projects} translations={translations} />
